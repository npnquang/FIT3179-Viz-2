<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storm Analysis Dashboard</title>
  <!-- Import Vega & Vega-Lite (does not have to be from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  
  <!-- Dashboard State Manager -->
  <script src="js/dashboard-state.js"></script>
  
  <!-- CSS file -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">
  
</head>
<body>
<h1>Storm Analysis Dashboard (2005-2025)</h1>

<!-- Floating Year Control -->
<div class="floating-controls">
  <div class="floating-year-control">
    <div class="control-header">
      <span class="control-title">Year Control</span>
      <button class="toggle-btn" id="toggleControls">-</button>
    </div>
    <div class="control-content" id="controlContent">
      <div class="year-slider-container">
        <label for="globalYear">Year: </label>
        <input type="range" id="globalYear" min="2005" max="2025" step="1" value="2010">
        <span id="yearDisplay" class="year-display">2010</span>
      </div>
      <div class="year-info">
        <small>Drag to change year for all charts</small>
      </div>
    </div>
  </div>
</div>

<h2>Proportion of Economic Damages by Natural Disaster Type</h2>
<div id="area_chart"></div>

<h2>Proportion of Deaths by Natural Disaster Type</h2>
<div id="area_chart_deaths"></div>

<h2>Storm Origin Locations</h2>
<div id="symbol_map"></div>

<h2>Number of Storms per Year</h2>
<div id="line_chart"></div>




<script type="text/javascript">
  // Initialize dashboard when page loads
  document.addEventListener('DOMContentLoaded', async function() {
    try {
      // Initialize the global dashboard state
      GlobalDashboardState.init();
      
      // Add example event listener
      GlobalDashboardState.addEventListener('yearChange', function(data) {
        console.log('Year changed from', data.oldYear, 'to', data.newYear);
      });
      
      // Load all visualizations using the dashboard state manager
      await Promise.all([
        GlobalDashboardState.loadVisualization('#line_chart', 'js/line_chart.vg.json', 'lineChart'),
        GlobalDashboardState.loadVisualization('#symbol_map', 'js/dotmap_map.vg.json', 'symbolMap'),
        GlobalDashboardState.loadVisualization('#area_chart', 'js/area_chart_disasters.vg.json', 'areaChart'),
        GlobalDashboardState.loadVisualization('#area_chart_deaths', 'js/area_chart_deaths.vg.json', 'areaChartDeaths')
      ]);
      
      console.log('Dashboard loaded successfully!');
      console.log('Current state:', GlobalDashboardState.getState());
      
    } catch (error) {
      console.error('Error loading dashboard:', error);
    }
  });

  // Add floating controls functionality
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggleControls');
    const controlContent = document.getElementById('controlContent');
    let isExpanded = true;

    toggleBtn.addEventListener('click', function() {
      isExpanded = !isExpanded;
      
      if (isExpanded) {
        controlContent.style.display = 'block';
        toggleBtn.textContent = '-';
        toggleBtn.setAttribute('aria-label', 'Collapse controls');
      } else {
        controlContent.style.display = 'none';
        toggleBtn.textContent = '+';
        toggleBtn.setAttribute('aria-label', 'Expand controls');
      }
    });

    // Add keyboard support
    toggleBtn.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleBtn.click();
      }
    });
  });
</script>

</body>
</html>